# 考勤计算器

基于弹性打卡制度的考勤计算 Web 应用，帮助员工计算在满足本周工时要求的前提下，当天最早的下班时间。

## 功能特性

### 核心功能
- **弹性工时计算**: 支持弹性上班时间（8:00-9:30）和对应下班时间（18:00-19:30）
- **工时累加**: 本周内超出的工时可累加到后续天数
- **午休自动扣除**: 每天固定午休 12:00-14:00（2小时），自动扣除
- **加班时长扣除**: 支持输入已申请的加班时长，从当天工时中扣除
- **智能光标跳转**: 填完上班时间自动跳转到下班时间，填完下班时间自动跳转到下一天

### 数据功能
- **手动输入**: 逐日输入上下班打卡时间
- **日期筛选**: 通过日期筛选器选择统计范围（最多7天）
- **数据保存**: 本地 IndexedDB 存储，隐私安全
- **导出图片**: 将考勤记录导出为 PNG 图片

### 假期功能
- **假期同步**: 从在线 API 获取最新的法定节假日数据
- **假期显示**: 日历中以淡绿色标记法定节假日，浅绿色标记周末
- **每月同步**: 每月只能同步一次，避免频繁请求

### 版本日志
- **更新日志**: 查看软件版本历史和更新内容

## 技术栈

- **前端框架**: React 18 + TypeScript
- **构建工具**: Vite
- **UI 组件库**: Ant Design 5.x
- **状态管理**: Zustand
- **数据存储**: IndexedDB (Dexie.js)
- **时间处理**: Day.js
- **图片导出**: html2canvas

## 快速开始

### 安装依赖
```bash
npm install
```

### 开发模式
```bash
npm run dev
```

### 构建生产版本
```bash
npm run build
```

### 预览生产构建
```bash
npm run preview
```

## 使用说明

### 基本使用

1. **设置工作天数**: 本周计划工作的天数（默认6天）
2. **输入打卡时间**: 逐日输入上下班打卡时间
3. **查看统计结果**:
   - 本周已完成天数和总有效工时
   - 本周要求总工时（工作天数 × 8 小时）
   - 剩余需要工时
   - 当天最早下班时间

### 时间规则

**上班时间**:
- 最早时间: 8:00
- 弹性时间: 8:00 - 9:30
- 早于 8:00 的打卡时间自动调整为 8:00

**下班时间**:
- 最早时间: 18:00
- 弹性时间: 18:00 - 19:30
- 不能早于 18:00
- 必须晚于上班时间

**午休时间**:
- 固定时间: 12:00 - 14:00（2小时）
- 跨越午休自动扣除 2 小时

### 日期筛选

- 点击工具栏的日期范围选择器
- 选择开始日期和结束日期（最多7天）
- 系统仅统计该日期范围内的工时数据

### 假期同步

- 点击"同步假期"按钮获取最新的法定节假日数据
- 每月只能同步一次
- 同步后日历中以淡绿色标记法定节假日

### 数据保存与导出

- **保存数据**: 点击"💾 保存"按钮保存当前数据到本地
- **导出图片**: 点击"导出图片"按钮将考勤记录导出为 PNG 图片

## 计算逻辑

### 单日有效工时

```
有效工时 = (下班时间 - 上班时间) - 午休时间(2h) - 已申请加班时长
```

### 本周累计工时

```
总有效工时 = Σ(每日有效工时)
剩余工时 = 本周要求工时 - 总有效工时
```

### 最早下班时间

```
今天需要的工时 = min(剩余工时, 8小时)
下班时间 = 上班时间 + 今天需要的工时 + 午休时间(如果跨越)
```

## 项目结构

```
attendance-calculator/
├── public/                      # 静态资源
├── src/
│   ├── components/              # 通用组件
│   │   └── VersionLogModal/    # 版本日志模态框
│   ├── data/                   # 静态数据
│   │   └── versionLogs.ts      # 版本日志数据
│   ├── pages/                  # 页面
│   │   └── Home/              # 主页
│   ├── services/               # 服务层
│   │   ├── db.service.ts       # 数据库服务
│   │   └── holiday.service.ts  # 假期服务
│   ├── stores/                 # 状态管理
│   │   └── attendance.store.ts # 考勤状态
│   ├── types/                  # 类型定义
│   │   └── attendance.types.ts # 考勤类型
│   ├── utils/                  # 工具函数
│   │   ├── calculation.utils.ts # 计算工具
│   │   ├── constants.ts        # 常量定义
│   │   └── time.utils.ts      # 时间工具
│   ├── App.tsx
│   └── main.tsx
├── package.json
├── tsconfig.json
├── vite.config.ts
├── REQUIREMENTS.md            # 需求文档
└── RULES.md                  # 规则文档
```

## 部署方案

### 静态部署（推荐）

完全免费，零维护成本：

- **GitHub Pages**: `npm run build` 后将 `dist` 目录推送到 GitHub 仓库，开启 Pages 服务
- **Netlify**: 直接拖放 `dist` 目录到 Netlify
- **Vercel**: 连接 GitHub 仓库自动部署

### 优点

- 零服务器成本
- 全球 CDN 加速
- 自动 HTTPS
- 支持自定义域名

## 隐私说明

- 所有数据仅存储在浏览器本地（IndexedDB）
- 不上传任何数据到服务器
- 数据完全私有安全

## 版本历史

查看应用内的"更新日志"按钮或 [REQUIREMENTS.md](./REQUIREMENTS.md) 文档。

## 许可证

MIT

## 致谢

- [Ant Design](https://ant.design/) - 企业级 UI 设计语言和 React UI 组件库
- [Day.js](https://day.js.org/) - 轻量级 JavaScript 时间日期处理库
- [Zustand](https://github.com/pmndrs/zustand) - 轻量级状态管理库
- [Dexie.js](https://dexie.org/) - IndexedDB 的封装库
